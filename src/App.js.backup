import React, { useState, useEffect } from 'react';
import { BrowserRouter as Router, useNavigate, useLocation } from 'react-router-dom';
import './App.css';
import Dashboard from './components/Dashboard';
import Browse from './components/Browse';
import Analysis from './components/Analysis';
import Setting from './components/Setting';
import ItemDetail from './components/ItemDetail';
import Login from './components/Login';
import Signup from './components/Signup';
import { getRefreshToken, refreshAccessToken, clearAllTokens, setAccessToken, hasValidStoredToken, setIsInitializing } from './utils/tokenUtils';

// ì•„ì´ì½˜ imports
import iconDashboard from './assets/icons/icon_dashboard.svg';
import iconBrowser from './assets/icons/icon_browser.svg';
import iconAnalysis from './assets/icons/icon_analysis.svg';
import iconSetting from './assets/icons/icon_setting.svg';

function AppContent() {
  const navigate = useNavigate();
  const location = useLocation();
  
  // ëª¨ë“  useState hooksë¥¼ ìµœìƒë‹¨ì— ë°°ì¹˜ (React Hooks ê·œì¹™ ì¤€ìˆ˜)
  const [user, setUser] = useState(null);
  const [activeTab, setActiveTab] = useState('dashboard');
  const [currentView, setCurrentView] = useState({ type: 'tab', data: null });
  const [touchStart, setTouchStart] = useState({ x: 0, y: 0, time: 0 });
  const [touchEnd, setTouchEnd] = useState({ x: 0, y: 0 });
  const [showAuthModal, setShowAuthModal] = useState('login');
  // ìŠ¤ì™€ì´í”„ ìƒíƒœ ì¶”ê°€
  const [isSwipingAllowed, setIsSwipingAllowed] = useState(true);
  const [swipeDirection, setSwipeDirection] = useState(null);
  const [wheelTimeout, setWheelTimeout] = useState(null);
  const [isHorizontalSwipe, setIsHorizontalSwipe] = useState(false);
  // íƒ­ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ ê´€ë ¨ ìƒíƒœ
  const [isSwiping, setIsSwiping] = useState(false);
  const [swipeProgress, setSwipeProgress] = useState(0);
  const [swipeOffset, setSwipeOffset] = useState(0);
  const [canSwipe, setCanSwipe] = useState(true);
  const [swipeThreshold] = useState(100); // íƒ­ ì „í™˜ ì„ê³„ì  (í”½ì…€)
  const [itemsData, setItemsData] = useState({
    pending: {
      series: [
        { 
          id: 1, 
          type: 'series',
          title: 'ë¯¸ë˜í˜• ë„ì‹œ ì‹œë¦¬ì¦ˆ', 
          description: 'ë¯¸ë˜í˜• ë””ìŠ¤í† í”¼ì•„ ì‹œë¦¬ì¦ˆ', 
          status: 'pending',
          feedbackCount: 0,
          createdAt: '2024-01-15',
          aiGenerated: true,
          content: '# ë„¤ì˜¤ ì‹œí‹° ì‹œë¦¬ì¦ˆ\n\n2087ë…„, ê¸°ìˆ ê³¼ ìë³¸ì´ ì§€ë°°í•˜ëŠ” ê±°ëŒ€ ë„ì‹œë¥¼ ë°°ê²½ìœ¼ë¡œ í•œ ì‹œë¦¬ì¦ˆì…ë‹ˆë‹¤...',
          feedbackHistory: []
        },
        { 
          id: 2, 
          type: 'series',
          title: 'íŒíƒ€ì§€ ì™•êµ­ ì‹œë¦¬ì¦ˆ', 
          description: 'ì¤‘ì„¸ íŒíƒ€ì§€ ì‹œë¦¬ì¦ˆ', 
          status: 'review', 
          feedbackCount: 2,
          createdAt: '2024-01-14',
          aiGenerated: true,
          content: '# ì•„ë¥´ì¹´ë‚˜ ì‹œë¦¬ì¦ˆ\n\në§ˆë²•ì´ ì¡´ì¬í•˜ëŠ” ì¤‘ì„¸ íŒíƒ€ì§€ ì„¸ê³„ë¥¼ ë°°ê²½ìœ¼ë¡œ í•œ ì‹œë¦¬ì¦ˆ...',
          feedbackHistory: []
        },
        { 
          id: 3, 
          type: 'series',
          title: 'ìš°ì£¼ ì •ê±°ì¥ ì‹œë¦¬ì¦ˆ', 
          description: 'SF ìš°ì£¼ ì •ê±°ì¥ ì‹œë¦¬ì¦ˆ', 
          status: 'pending',
          feedbackCount: 0,
          createdAt: '2024-01-13',
          aiGenerated: true,
          content: '# ì˜¤ë©”ê°€ ìŠ¤í…Œì´ì…˜ ì‹œë¦¬ì¦ˆ\n\nì§€êµ¬ ê¶¤ë„ìƒì˜ ê±°ëŒ€í•œ ìš°ì£¼ ì •ê±°ì¥ì„ ë°°ê²½ìœ¼ë¡œ í•œ ì‹œë¦¬ì¦ˆ...',
          feedbackHistory: []
        }
      ],
      character: [
        { 
          id: 1, 
          type: 'character',
          title: 'ì£¼ì¸ê³µ - ì•Œë ‰ìŠ¤', 
          description: 'ì‚¬ì´ë²„ í•´ì»¤ ìºë¦­í„°', 
          status: 'pending',
          feedbackCount: 1,
          createdAt: '2024-01-16',
          aiGenerated: true,
          seriesId: 1,
          imageUrl: '/images/alex-character.jpg',
          content: '## ìºë¦­í„° í”„ë¡œí•„\n\n**ì´ë¦„**: ì•Œë ‰ìŠ¤ ì²¸\n**ë‚˜ì´**: 28ì„¸\n**ì§ì—…**: ì‚¬ì´ë²„ í•´ì»¤...',
          feedbackHistory: []
        },
        { 
          id: 2, 
          type: 'character',
          title: 'ì¡°ë ¥ì - ë¯¸ë¼', 
          description: 'ë§ˆë²•ì‚¬ ìºë¦­í„°', 
          status: 'pending',
          feedbackCount: 0,
          createdAt: '2024-01-15',
          aiGenerated: true,
          seriesId: 2,
          imageUrl: '/images/mira-character.jpg',
          content: '## ìºë¦­í„° í”„ë¡œí•„\n\n**ì´ë¦„**: ë¯¸ë¼ ìŠ¤í†°\n**ë‚˜ì´**: 25ì„¸\n**ì§ì—…**: ê¶ì • ë§ˆë²•ì‚¬...',
          feedbackHistory: []
        },
        { 
          id: 3, 
          type: 'character',
          title: 'ë¹ŒëŸ° - ë‹¤í¬ë¡œë“œ', 
          description: 'ìµœì¢… ë³´ìŠ¤ ìºë¦­í„°', 
          status: 'pending',
          feedbackCount: 0,
          createdAt: '2024-01-18',
          aiGenerated: true,
          seriesId: 2,
          imageUrl: '/images/darklord-character.jpg',
          content: '## ìºë¦­í„° í”„ë¡œí•„\n\n**ì´ë¦„**: ë‹¤í¬ë¡œë“œ ë°”ë¡ \n**ë‚˜ì´**: ë¶ˆëª…\n**ì§ì—…**: ì–´ë‘ ì˜ êµ°ì£¼...',
          feedbackHistory: []
        }
      ],
      episode: [
        { 
          id: 1, 
          type: 'episode',
          title: 'ì²« ë²ˆì§¸ ë§Œë‚¨', 
          description: 'ì£¼ì¸ê³µê³¼ ì¡°ë ¥ìì˜ ì²« ë§Œë‚¨', 
          status: 'pending',
          feedbackCount: 0,
          createdAt: '2024-01-20',
          aiGenerated: true,
          seriesId: 1,
          content: '# ì—í”¼ì†Œë“œ 1: ì²« ë²ˆì§¸ ë§Œë‚¨\n\nì•Œë ‰ìŠ¤ê°€ ë¯¸ë¼ë¥¼ ì²˜ìŒ ë§Œë‚˜ëŠ” ìˆœê°„...',
          feedbackHistory: []
        },
        { 
          id: 2, 
          type: 'episode',
          title: 'ë¹„ë°€ ì„ë¬´', 
          description: 'ê·¹ë¹„ í•´í‚¹ ì„ë¬´', 
          status: 'pending',
          feedbackCount: 1,
          createdAt: '2024-01-19',
          aiGenerated: true,
          seriesId: 1,
          content: '# ì—í”¼ì†Œë“œ 2: ë¹„ë°€ ì„ë¬´\n\nê¸°ì—…ì˜ ì„œë²„ì— ì¹¨íˆ¬í•˜ëŠ” ìœ„í—˜í•œ ì„ë¬´...',
          feedbackHistory: []
        }
      ],
      video: [
        { 
          id: 1, 
          type: 'video',
          title: 'ì˜¤í”„ë‹ ì˜ìƒ', 
          description: 'ê²Œì„ ì¸íŠ¸ë¡œ ì˜ìƒ', 
          status: 'pending',
          feedbackCount: 0,
          createdAt: '2024-01-22',
          aiGenerated: true,
          videoUrl: '/videos/opening-intro.mp4',
          duration: '00:02:30',
          feedbackHistory: []
        },
        { 
          id: 2, 
          type: 'video',
          title: 'ìºë¦­í„° ì†Œê°œ ì˜ìƒ', 
          description: 'ì£¼ìš” ìºë¦­í„° ì†Œê°œ', 
          status: 'pending',
          feedbackCount: 1,
          createdAt: '2024-01-21',
          aiGenerated: true,
          videoUrl: '/videos/character-intro.mp4',
          duration: '00:01:45',
          feedbackHistory: []
        },
        { 
          id: 3, 
          type: 'video',
          title: 'ê²Œì„í”Œë ˆì´ íŠ¸ë ˆì¼ëŸ¬', 
          description: 'ê²Œì„ í”Œë ˆì´ ì˜ìƒ', 
          status: 'pending',
          feedbackCount: 0,
          createdAt: '2024-01-20',
          aiGenerated: true,
          videoUrl: '/videos/gameplay-trailer.mp4',
          duration: '00:03:15',
          feedbackHistory: []
        }
      ]
    },
    working: {
      series: [
        { 
          id: 4, 
          type: 'series',
          title: 'ìš°ì£¼ ì „ìŸ ì‹œë¦¬ì¦ˆ', 
          description: 'SF ìš°ì£¼ ë°°ê²½ ì‹œë¦¬ì¦ˆ', 
          status: 'generating',
          feedbackCount: 3,
          createdAt: '2024-01-13',
          aiGenerated: true,
          workStatus: 'revision_requested',
          content: '# ì€í•˜ê³„ ì „ìŸ ì‹œë¦¬ì¦ˆ\n\nì„œê¸° 3021ë…„, ì€í•˜ê³„ë¥¼ ë’¤í”ë“œëŠ” ëŒ€ì „ìŸì„ ë°°ê²½ìœ¼ë¡œ í•œ ì‹œë¦¬ì¦ˆ...',
          feedbackHistory: []
        }
      ],
      character: [
        { 
          id: 4, 
          type: 'character',
          title: 'ì‚¬ë ¹ê´€ - ë¼ì´ë”', 
          description: 'ìš°ì£¼ í•¨ëŒ€ ì‚¬ë ¹ê´€', 
          status: 'generating',
          feedbackCount: 1,
          createdAt: '2024-01-15',
          aiGenerated: true,
          seriesId: 3,
          workStatus: 'revision_requested',
          imageUrl: '/images/rider-character.jpg',
          content: '## ìºë¦­í„° í”„ë¡œí•„\n\n**ì´ë¦„**: ë¼ì´ë” ìŠ¤ì¹´ì´\n**ë‚˜ì´**: 35ì„¸\n**ì§ì—…**: í•¨ëŒ€ ì‚¬ë ¹ê´€...',
          feedbackHistory: []
        }
      ],
      episode: [
        { 
          id: 3, 
          type: 'episode',
          title: 'ì²« ë²ˆì§¸ ì „íˆ¬', 
          description: 'ì´ˆê¸° ì „íˆ¬ ì‹œí€€ìŠ¤', 
          status: 'generating',
          feedbackCount: 0,
          createdAt: '2024-01-18',
          aiGenerated: true,
          seriesId: 3,
          workStatus: 'generating',
          content: '# ì—í”¼ì†Œë“œ 3: ì²« ë²ˆì§¸ ì „íˆ¬\n\ní•¨ëŒ€ê°€ ì ê³¼ ì¡°ìš°í•˜ëŠ” ìˆœê°„...',
          feedbackHistory: []
        }
      ],
      video: [
        { 
          id: 4, 
          type: 'video',
          title: 'ì „íˆ¬ ì‹œí€€ìŠ¤ ì˜ìƒ', 
          description: 'ìš°ì£¼ ì „íˆ¬ ì¥ë©´', 
          status: 'generating',
          feedbackCount: 1,
          createdAt: '2024-01-17',
          aiGenerated: true,
          videoUrl: '/videos/space-battle.mp4',
          duration: '00:04:20',
          workStatus: 'generating',
          feedbackHistory: []
        }
      ]
    },
    approved: {
      series: [
        { 
          id: 5, 
          type: 'series', 
          title: 'ì•„ë¥´ì¹´ë””ì•„ ì‹œë¦¬ì¦ˆ', 
          description: 'íŒíƒ€ì§€ ì¤‘ì„¸ ì‹œë¦¬ì¦ˆ',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-10',
          aiGenerated: true,
          content: '# ì•„ë¥´ì¹´ë””ì•„ ì‹œë¦¬ì¦ˆ\n\në§ˆë²•ê³¼ ê²€ì´ ê³µì¡´í•˜ëŠ” íŒíƒ€ì§€ ì„¸ê³„ë¥¼ ë°°ê²½ìœ¼ë¡œ í•œ ì‹œë¦¬ì¦ˆ. ì™•êµ­ì˜ ì¤‘ì‹¬ì—ëŠ” ê´‘ëŒ€í•œ ë„ì‹œ ì•„ë¥´ì¹´ë””ì•„ê°€ ìˆê³ , ì£¼ë³€ì„ ë‹¤ì–‘í•œ ë˜ì „ê³¼ ìœ„í—˜í•œ ì§€ì—­ì´ ë‘˜ëŸ¬ì‹¸ê³  ìˆë‹¤. ì™•êµ­ì˜ í‰í™”ëŠ” ìš©ë§¹í•œ ëª¨í—˜ê°€ë“¤ì— ì˜í•´ ì§€ì¼œì§€ê³  ìˆë‹¤...',
          feedbackHistory: []
        },
        { 
          id: 6, 
          type: 'series', 
          title: 'ë„¤ì˜¤ ì‹œí‹° ì‹œë¦¬ì¦ˆ', 
          description: 'ì‚¬ì´ë²„í‘í¬ ë¯¸ë˜ ì‹œë¦¬ì¦ˆ',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-09',
          aiGenerated: true,
          content: '# ë„¤ì˜¤ ì‹œí‹° ì‹œë¦¬ì¦ˆ\n\n2087ë…„, ê±°ëŒ€ ê¸°ì—…ë“¤ì´ ì„¸ê³„ë¥¼ ì§€ë°°í•˜ëŠ” ë””ìŠ¤í† í”¼ì•„ ë¯¸ë˜ë¥¼ ë°°ê²½ìœ¼ë¡œ í•œ ì‹œë¦¬ì¦ˆ. ë„¤ì˜¨ ë¶ˆë¹›ì´ ê°€ë“í•œ ë„ì‹œëŠ” ì²¨ë‹¨ ê¸°ìˆ ê³¼ ì‚¬íšŒì  ë¶ˆí‰ë“±ì´ ê³µì¡´í•œë‹¤. ì‚¬ì´ë²„ ê°œì¡°ì™€ ì¸ê³µì§€ëŠ¥ì´ ì¼ìƒí™”ëœ ì„¸ê³„ì—ì„œ í•´ì»¤ë“¤ê³¼ ë°˜ë€êµ°ë“¤ì´ ì‹œìŠ¤í…œì— ì €í•­í•œë‹¤...',
          feedbackHistory: []
        }
      ],
      character: [
        { 
          id: 5, 
          type: 'character', 
          title: 'ë¨¸ë¡œìš° ìƒì¸', 
          description: 'ì•„ì´í…œ íŒë§¤ ìºë¦­í„°',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-08',
          aiGenerated: true,
          seriesId: 5,
          episodeId: 4,
          imageUrl: '/images/shop-keeper.jpg',
          content: '## ìºë¦­í„° í”„ë¡œí•„\n\n**ì´ë¦„**: ë¨¸ë¡œìš° ìƒì¸\n**ë‚˜ì´**: 45ì„¸\n**ì§ì—…**: ì¡í™”ì  ì£¼ì¸\n\nì¹œì ˆí•˜ê³  ì •ì§í•œ ìƒì¸ìœ¼ë¡œ ëª¨í—˜ê°€ë“¤ì—ê²Œ í•„ìš”í•œ ì•„ì´í…œë“¤ì„ íŒë§¤í•©ë‹ˆë‹¤. ì™•êµ­ ì „ì—­ì„ ì—¬í–‰í•˜ë©° ìˆ˜ì§‘í•œ ë‹¤ì–‘í•œ ì´ì•¼ê¸°ë„ ë“¤ë ¤ì¤ë‹ˆë‹¤...',
          feedbackHistory: []
        },
        { 
          id: 6, 
          type: 'character', 
          title: 'ì—˜ë¼ ê°€ì´ë“œ', 
          description: 'íŠœí† ë¦¬ì–¼ ê°€ì´ë“œ',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-07',
          aiGenerated: true,
          seriesId: 5,
          episodeId: 5,
          imageUrl: '/images/guide-npc.jpg',
          content: '## ìºë¦­í„° í”„ë¡œí•„\n\n**ì´ë¦„**: ì—˜ë¼ ê°€ì´ë“œ\n**ë‚˜ì´**: 28ì„¸\n**ì§ì—…**: ì‹ ê·œ ëª¨í—˜ê°€ ì•ˆë‚´ì›\n\nëª¨í—˜ê°€ ê¸¸ë“œì˜ ìƒˆ íšŒì›ë“¤ì„ ì•ˆë‚´í•˜ëŠ” ì—­í• ì„ ë§¡ê³  ìˆìŠµë‹ˆë‹¤. ì¹œì ˆí•˜ê³  ìœ ì¾Œí•œ ì„±ê²©ìœ¼ë¡œ ì‹ ê·œ ëª¨í—˜ê°€ë“¤ì—ê²Œ ì¸ê¸°ê°€ ë§ìŠµë‹ˆë‹¤...',
          feedbackHistory: []
        },
        { 
          id: 7, 
          type: 'character', 
          title: 'ì œì´í¬ ë ˆì´ì„œ', 
          description: 'ì‚¬ì´ë²„ ë ˆì´ì„œ',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-06',
          aiGenerated: true,
          seriesId: 6,
          episodeId: 6,
          imageUrl: '/images/cyber-racer.jpg',
          content: '## ìºë¦­í„° í”„ë¡œí•„\n\n**ì´ë¦„**: ì œì´í¬ ë ˆì´ì„œ\n**ë‚˜ì´**: 25ì„¸\n**ì§ì—…**: ì–¸ë”ê·¸ë¼ìš´ë“œ ë ˆì´ì„œ\n\në„¤ì˜¤ ì‹œí‹°ì˜ ë¶ˆë²• ë ˆì´ì‹± ì±”í”¼ì–¸. ì‚¬ì´ë²„ë„· í•´í‚¹ ëŠ¥ë ¥ê³¼ ë›°ì–´ë‚œ ë“œë¼ì´ë¹™ ê¸°ìˆ ì„ ê²¸ë¹„í–ˆë‹¤. ê±°ëŒ€ ê¸°ì—… ë§ˆí¬ë¡œí…ì˜ ë¹„ë°€ì„ ìš°ì—°íˆ ì•Œê²Œ ëœ í›„ ì«“ê¸°ëŠ” ì‹ ì„¸ê°€ ë¨...',
          feedbackHistory: []
        },
        { 
          id: 8, 
          type: 'character', 
          title: 'ì•„ì´ë¦¬ìŠ¤', 
          description: 'AI í•´í‚¹ ì „ë¬¸ê°€',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-05',
          aiGenerated: true,
          seriesId: 6,
          episodeId: 7,
          imageUrl: '/images/ai-hacker.jpg',
          content: '## ìºë¦­í„° í”„ë¡œí•„\n\n**ì´ë¦„**: ì•„ì´ë¦¬ìŠ¤\n**ë‚˜ì´**: 23ì„¸\n**ì§ì—…**: í•´ì»¤\n\nì²œì¬ì ì¸ í•´í‚¹ ì‹¤ë ¥ì„ ê°€ì§„ ì €í•­êµ° ë©¤ë²„. 10ëŒ€ ì‹œì ˆ ìì‹ ì˜ ë‡Œì— ì‹ ê²½ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§ì ‘ ì´ì‹í•´ AIì™€ ì§ì ‘ í†µì‹ í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì„ ê°€ì§€ê²Œ ë¨. ê±°ëŒ€ ê¸°ì—…ë“¤ì˜ ì •ë³´ë¥¼ í›”ì³ ì €í•­êµ°ì— ì œê³µ...',
          feedbackHistory: []
        }
      ],
      episode: [
        { 
          id: 4, 
          type: 'episode', 
          title: 'ì•„ë¥´ì¹´ë””ì•„ í”„ë¡¤ë¡œê·¸', 
          description: 'ëª¨í—˜ì˜ ì‹œì‘',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-06',
          aiGenerated: true,
          seriesId: 5,
          content: '# ì—í”¼ì†Œë“œ 1: ì•„ë¥´ì¹´ë””ì•„ í”„ë¡¤ë¡œê·¸\n\nì£¼ì¸ê³µì´ ì•„ë¥´ì¹´ë””ì•„ ì™•êµ­ì— ì²˜ìŒ ë„ì°©í•˜ëŠ” ì´ì•¼ê¸°. ëª¨í—˜ê°€ ê¸¸ë“œì— ë“±ë¡í•˜ê³  ì²« ì„ë¬´ë¥¼ ë°›ê¸°ê¹Œì§€ì˜ ê³¼ì •ì„ ë‹¤ë£¬ë‹¤. ì²˜ìŒìœ¼ë¡œ ë¨¸ë¡œìš° ìƒì¸ê³¼ ë§Œë‚˜ê²Œ ë˜ê³ , ì™•êµ­ì˜ ì£¼ìš” ì§€ì—­ë“¤ì„ ì†Œê°œë°›ëŠ”ë‹¤...',
          feedbackHistory: []
        },
        { 
          id: 5, 
          type: 'episode', 
          title: 'ì•„ë¥´ì¹´ë””ì•„ íŠœí† ë¦¬ì–¼', 
          description: 'ê¸°ë³¸ ì‹œìŠ¤í…œ í•™ìŠµ',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-05',
          aiGenerated: true,
          seriesId: 5,
          content: '# ì—í”¼ì†Œë“œ 2: ì•„ë¥´ì¹´ë””ì•„ íŠœí† ë¦¬ì–¼\n\nì—˜ë¼ ê°€ì´ë“œì˜ ì•ˆë‚´ë¡œ ê²Œì„ì˜ ê¸°ë³¸ ì‹œìŠ¤í…œì„ ë°°ìš°ëŠ” ì—í”¼ì†Œë“œ. ì „íˆ¬, ì•„ì´í…œ ì‚¬ìš©, ìŠ¤í‚¬ ì‹œìŠ¤í…œ ë“±ì„ ìµíˆê³  ê°„ë‹¨í•œ ì „íˆ¬ ì‹œë®¬ë ˆì´ì…˜ì„ í†µí•´ í”Œë ˆì´ì–´ê°€ ê²Œì„ ë©”ì»¤ë‹ˆì¦˜ì— ì ì‘í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ”ë‹¤...',
          feedbackHistory: []
        },
        { 
          id: 6, 
          type: 'episode', 
          title: 'ë„¤ì˜¤ ì‹œí‹°ì˜ ë°¤', 
          description: 'ë ˆì´ì‹± ëŒ€ê²°',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-04',
          aiGenerated: true,
          seriesId: 6,
          content: '# ì—í”¼ì†Œë“œ 1: ë„¤ì˜¤ ì‹œí‹°ì˜ ë°¤\n\në„¤ì˜¨ ë¶ˆë¹›ìœ¼ë¡œ ê°€ë“í•œ ë„¤ì˜¤ ì‹œí‹°ì˜ ë°¤ê±°ë¦¬ì—ì„œ í¼ì³ì§€ëŠ” ë¶ˆë²• ë ˆì´ì‹± ëŒ€íšŒë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì´ì•¼ê¸°ê°€ ì‹œì‘ëœë‹¤. ì£¼ì¸ê³µ ì œì´í¬ëŠ” ëŒ€íšŒì—ì„œ ìš°ìŠ¹í•˜ë©° ëª…ì„±ì„ ìŒ“ì§€ë§Œ, ë ˆì´ìŠ¤ ë„ì¤‘ ë§ˆí¬ë¡œí… ê¸°ì—…ì˜ ë¹„ë°€ ì •ë³´ê°€ ë‹´ê¸´ ë°ì´í„° ì¹©ì„ ìš°ì—°íˆ íšë“í•˜ê²Œ ëœë‹¤...',
          feedbackHistory: []
        },
        { 
          id: 7, 
          type: 'episode', 
          title: 'ë””ì§€í„¸ ì €í•­êµ°', 
          description: 'ë§ˆí¬ë¡œí…ì— ëŒ€í•­',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-03',
          aiGenerated: true,
          seriesId: 6,
          content: '# ì—í”¼ì†Œë“œ 2: ë””ì§€í„¸ ì €í•­êµ°\n\në§ˆí¬ë¡œí… ê¸°ì—…ì˜ ë³´ì•ˆ ë¶€ëŒ€ì— ì«“ê¸°ëŠ” ì œì´í¬ëŠ” í•´ì»¤ ì•„ì´ë¦¬ìŠ¤ì™€ ë§Œë‚˜ ì €í•­êµ°ì— í•©ë¥˜í•œë‹¤. ì´ë“¤ì€ ë§ˆí¬ë¡œí…ì´ ê°œë°œ ì¤‘ì¸ ë‡Œ ì œì–´ ì‹œìŠ¤í…œì˜ ì¡´ì¬ë¥¼ ë°í˜€ë‚´ê³ , ì´ë¥¼ ë§‰ê¸° ìœ„í•œ ê³„íšì„ ì„¸ìš´ë‹¤...',
          feedbackHistory: []
        }
      ],
      video: [
        { 
          id: 5, 
          type: 'video', 
          title: 'ì•„ë¥´ì¹´ë””ì•„ íŠœí† ë¦¬ì–¼ ì˜ìƒ', 
          description: 'ê²Œì„ ê°€ì´ë“œ ì˜ìƒ',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-02',
          aiGenerated: true,
          seriesId: 5,
          episodeId: 5,
          videoUrl: '/videos/tutorial-guide.mp4',
          duration: '00:02:30',
          feedbackHistory: []
        },
        { 
          id: 6, 
          type: 'video', 
          title: 'ì•„ë¥´ì¹´ë””ì•„ í”„ë¡¤ë¡œê·¸ ì‹œë„¤ë§ˆí‹±', 
          description: 'ê²Œì„ ì˜¤í”„ë‹ ì‹œí€€ìŠ¤',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-01',
          aiGenerated: true,
          seriesId: 5,
          episodeId: 4,
          videoUrl: '/videos/prologue-cinematic.mp4',
          duration: '00:03:45',
          feedbackHistory: []
        },
        { 
          id: 7, 
          type: 'video', 
          title: 'ë„¤ì˜¤ ì‹œí‹° ë ˆì´ìŠ¤ íŠ¸ë ˆì¼ëŸ¬', 
          description: 'ë ˆì´ì‹± ì‹œí€€ìŠ¤ ì˜ìƒ',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-01',
          aiGenerated: true,
          seriesId: 6,
          episodeId: 6,
          videoUrl: '/videos/neo-city-race.mp4',
          duration: '00:02:15',
          feedbackHistory: []
        },
        { 
          id: 8, 
          type: 'video', 
          title: 'ë””ì§€í„¸ ì €í•­êµ° í‹°ì €', 
          description: 'í•´í‚¹ ì‹œí€€ìŠ¤ ì˜ìƒ',
          status: 'approved',
          feedbackCount: 0,
          createdAt: '2024-01-01',
          aiGenerated: true,
          seriesId: 6,
          episodeId: 7,
          videoUrl: '/videos/digital-resistance.mp4',
          duration: '00:01:45',
          feedbackHistory: []
        }
      ]
    }
  });

  // useEffectëŠ” hooks ì¤‘ì—ì„œ useState ë‹¤ìŒì— ë°°ì¹˜
  useEffect(() => {
    const initializeAuth = async () => {
      console.log('ğŸ”„ ì•± ì´ˆê¸°í™” ì¤‘... ì¸ì¦ ìƒíƒœ í™•ì¸');
      
      // ì´ˆê¸°í™” ì‹œì‘ í”Œë˜ê·¸ ì„¤ì •
      setIsInitializing(true);
      
      const userData = localStorage.getItem('userData');
      const refreshToken = getRefreshToken();
      
      console.log('ğŸ“‹ ì €ì¥ëœ ë°ì´í„° í™•ì¸:', {
        hasUserData: !!userData,
        hasRefreshToken: !!refreshToken,
        hasValidStoredToken: hasValidStoredToken(),
        devMode: process.env.REACT_APP_DEV_MODE
      });

      // í•„ìˆ˜ ë°ì´í„°ê°€ ëª¨ë‘ ìˆëŠ”ì§€ í™•ì¸
      if (!userData || !refreshToken) {
        console.log('âš ï¸ í•„ìˆ˜ ì¸ì¦ ë°ì´í„° ì—†ìŒ - ë¡œê·¸ì¸ í•„ìš”');
        if (userData || refreshToken) {
          clearAllTokens(); // ë¶ˆì™„ì „í•œ ë°ì´í„° ì •ë¦¬
        }
        setUser(null);
        setIsInitializing(false); // ì´ˆê¸°í™” ì™„ë£Œ
        return;
      }

      try {
        const parsedUserData = JSON.parse(userData);
        
        // ê°œë°œ ëª¨ë“œì—ì„œ admin ì‚¬ìš©ìëŠ” ë°”ë¡œ ë³µì›
        if (process.env.REACT_APP_DEV_MODE === 'true' && parsedUserData.email === 'admin@test.com') {
          console.log('ğŸ”§ ê°œë°œ ëª¨ë“œ: admin ì‚¬ìš©ì ì¦‰ì‹œ ë³µì›');
          const dummyAccessToken = 'dev_access_token_' + Date.now();
          setAccessToken(dummyAccessToken);
          setUser(parsedUserData);
          setIsInitializing(false); // ì´ˆê¸°í™” ì™„ë£Œ
          return;
        }
        
        // ì €ì¥ëœ í† í°ì˜ ìœ íš¨ì„± í™•ì¸
        if (hasValidStoredToken()) {
          // í† í°ì´ ì—¬ì „íˆ ìœ íš¨í•˜ë©´ ì¦‰ì‹œ ë³µì› (ê°±ì‹ í•˜ì§€ ì•ŠìŒ)
          console.log('âœ… ì €ì¥ëœ í† í°ì´ ìœ íš¨í•¨ - ì¦‰ì‹œ ë³µì› (ê°±ì‹  ì—†ìŒ)');
          
          // ë©”ëª¨ë¦¬ì— Access Tokenì´ ì—†ìœ¼ë¯€ë¡œ ì €ì¥ëœ í† í° ì •ë³´ë¡œ ë”ë¯¸ í† í° ìƒì„±
          // ì‹¤ì œ API ìš”ì²­ ì‹œì—ëŠ” apiRequestì—ì„œ í•„ìš”ì‹œ ê°±ì‹ ë¨
          const dummyAccessToken = 'valid_stored_token_' + Date.now();
          setAccessToken(dummyAccessToken);
          setUser(parsedUserData);
          setIsInitializing(false); // ì´ˆê¸°í™” ì™„ë£Œ
        } else {
          // í† í°ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì—†ìœ¼ë©´ ìƒˆë¡œ ë°œê¸‰
          console.log('ğŸ”‘ í† í°ì´ ë§Œë£Œë¨ - ìƒˆë¡œ ë°œê¸‰ í•„ìš”');
          
          try {
            const newAccessToken = await refreshAccessToken();
            if (newAccessToken) {
              setUser(parsedUserData);
              console.log('âœ… í† í° ê°±ì‹  í›„ ë³µì› ì„±ê³µ:', parsedUserData.username || parsedUserData.email);
              setIsInitializing(false); // ì´ˆê¸°í™” ì™„ë£Œ
            }
          } catch (error) {
            console.error('âŒ í† í° ê°±ì‹  ì‹¤íŒ¨:', error);
            clearAllTokens();
            setUser(null);
            setIsInitializing(false); // ì´ˆê¸°í™” ì™„ë£Œ (ì‹¤íŒ¨)
          }
        }
        
      } catch (error) {
        console.error('ì‚¬ìš©ì ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', error);
        clearAllTokens();
        setUser(null);
        setIsInitializing(false); // ì´ˆê¸°í™” ì™„ë£Œ (ì‹¤íŒ¨)
      }
    };

    initializeAuth();
    
    // ì „ì—­ ìŠ¤í¬ë¡¤ ë° í„°ì¹˜ ë°©ì§€
    const preventAllScrolling = (e) => {
      // main-content ë‚´ë¶€ê°€ ì•„ë‹Œ ê²½ìš° ìŠ¤í¬ë¡¤ ë°©ì§€
      const target = e.target;
      const mainContent = target.closest('.main-content');
      
      if (!mainContent) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    };

    const preventKeyboardScrolling = (e) => {
      // ìŠ¤í˜ì´ìŠ¤ë°”, í™”ì‚´í‘œ í‚¤ ë“±ìœ¼ë¡œ ì¸í•œ í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë°©ì§€
      const scrollKeys = [32, 33, 34, 35, 36, 37, 38, 39, 40]; // space, page up/down, home, end, arrows
      if (scrollKeys.includes(e.keyCode)) {
        const target = e.target;
        const mainContent = target.closest('.main-content');
        
        if (!mainContent) {
          e.preventDefault();
          return false;
        }
      }
    };

    // ë¸Œë¼ìš°ì € ê¸°ë³¸ ì œìŠ¤ì²˜ ë°©ì§€
    const preventGestures = (e) => {
      // main-content ë‚´ë¶€ê°€ ì•„ë‹Œ ê²½ìš° ëª¨ë“  í„°ì¹˜ ë°©ì§€
      const target = e.target;
      const mainContent = target.closest('.main-content');
      
      if (!mainContent) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
      
      // íƒ­ ì „í™˜ ì²˜ë¦¬ ì¤‘ì¼ ë•ŒëŠ” ì¶”ê°€ ì œìŠ¤ì²˜ ë°©ì§€
      if (!canSwipe) {
        console.log('Preventing gesture - tab change in progress');
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
      
      // ê°€ë¡œ ìŠ¤ì™€ì´í”„ë¡œ ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸° ë°©ì§€ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
      if (e.touches && e.touches.length === 1) {
        const deltaX = Math.abs(e.touches[0].clientX - window.innerWidth / 2);
        const deltaY = Math.abs(e.touches[0].clientY - window.innerHeight / 2);
        
        if (deltaX > deltaY && deltaX > 50) {
          console.log('Preventing browser gesture');
          e.preventDefault();
        }
      }
    };
    
    // ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.addEventListener('touchstart', preventGestures, { passive: false });
    document.addEventListener('touchmove', preventGestures, { passive: false });
    document.addEventListener('wheel', preventAllScrolling, { passive: false });
    document.addEventListener('scroll', preventAllScrolling, { passive: false });
    document.addEventListener('keydown', preventKeyboardScrolling, { passive: false });
    
    // ì •ë¦¬ í•¨ìˆ˜
    return () => {
      document.removeEventListener('touchstart', preventGestures);
      document.removeEventListener('touchmove', preventGestures);
      document.removeEventListener('wheel', preventAllScrolling);
      document.removeEventListener('scroll', preventAllScrolling);
      document.removeEventListener('keydown', preventKeyboardScrolling);
    };
  }, [canSwipe]);

  // URL ê²½ë¡œì— ë”°ë¼ activeTab ì„¤ì •
  useEffect(() => {
    const path = location.pathname;
    if (path === '/' || path === '/dashboard') {
      setActiveTab('dashboard');
    } else if (path === '/browse') {
      setActiveTab('browse');
    } else if (path === '/analysis') {
      setActiveTab('analysis');
    } else if (path === '/setting') {
      setActiveTab('setting');
    }
  }, [location.pathname]);

  // íƒ­ ì „í™˜ í•¨ìˆ˜
  const handleTabChange = (tabId) => {
    // ê°™ì€ íƒ­ìœ¼ë¡œ ì „í™˜ ì‹œë„í•˜ë©´ ë¬´ì‹œ (ê°€ì¥ ë¨¼ì € ì²´í¬)
    if (activeTab === tabId) {
      console.log('Tab change ignored - same tab');
      return;
    }
    
    if (!canSwipe) {
      console.log('Tab change blocked - already processing');
      return; // ìŠ¤ì™€ì´í”„ ì¤‘ì´ë©´ íƒ­ ë³€ê²½ ë°©ì§€
    }
    
    console.log('Tab changing from', activeTab, 'to', tabId);
    
    setActiveTab(tabId);
    switch (tabId) {
      case 'dashboard':
        navigate('/dashboard');
        break;
      case 'browse':
        navigate('/browse');
        break;
      case 'analysis':
        navigate('/analysis');
        break;
      case 'setting':
        navigate('/setting');
        break;
      default:
        navigate('/dashboard');
    }
  };

  // íƒ­ ì¸ë±ìŠ¤ ê³„ì‚°
  const getTabIndex = (tabId) => {
    return tabs.findIndex(tab => tab.id === tabId);
  };

  // íƒ­ ì˜¤í”„ì…‹ ê³„ì‚°
  const getTabOffset = () => {
    const currentIndex = getTabIndex(activeTab);
    return -(currentIndex * 25) + swipeOffset; // 25% = 100% / 4 tabs
  };

  // íƒ­ ì •ì˜
  const tabs = [
    { id: 'dashboard', label: 'Dashboard', icon: iconDashboard },
    { id: 'browse', label: 'Browse', icon: iconBrowser },
    { id: 'analysis', label: 'Analysis', icon: iconAnalysis },
    { id: 'setting', label: 'Setting', icon: iconSetting }
  ];

  // ë¡œê·¸ì¸ ì„±ê³µ í•¸ë“¤ëŸ¬
  const handleLoginSuccess = (accessToken, userData) => {
    // Access Tokenì€ ì´ë¯¸ tokenUtilsì—ì„œ ì„¤ì •ë¨
    // userDataë§Œ localStorageì— ì €ì¥
    localStorage.setItem('userData', JSON.stringify(userData));
    setUser(userData);
  };

  // ì¸ì¦ ëª¨ë“œ ì „í™˜
  const handleAuthSwitch = (authType) => {
    setShowAuthModal(authType);
  };

  // ë¡œê·¸ì•„ì›ƒ í•¸ë“¤ëŸ¬
  const handleLogout = () => {
    clearAllTokens();
    setUser(null);
  };

  // ìŠ¤ì™€ì´í”„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  const handleTouchStart = (e) => {
    if (!isSwipingAllowed || currentView.type === 'detail') return;
    
    // ì´ë¯¸ ìŠ¤ì™€ì´í”„ ì²˜ë¦¬ ì¤‘ì´ë©´ ë¬´ì‹œ (ë” ì—„ê²©í•˜ê²Œ ì²´í¬)
    if (!canSwipe) {
      console.log('Touch start ignored - already processing');
      e.preventDefault();
      e.stopPropagation();
      return;
    }
    
    setTouchStart({
      x: e.touches[0].clientX,
      y: e.touches[0].clientY,
      time: Date.now()
    });
    setTouchEnd({ x: 0, y: 0 });
    setSwipeDirection(null);
    setIsHorizontalSwipe(false);
    setIsSwiping(false);
    setSwipeProgress(0);
    setSwipeOffset(0);
    
    console.log('Touch Start:', { x: e.touches[0].clientX, y: e.touches[0].clientY, canSwipe });
  };

  const handleTouchMove = (e) => {
    if (!isSwipingAllowed || !touchStart.x || currentView.type === 'detail' || !canSwipe) return;
    
    const currentX = e.touches[0].clientX;
    const currentY = e.touches[0].clientY;
    
    setTouchEnd({
      x: currentX,
      y: currentY
    });

    // ìŠ¤ì™€ì´í”„ ë°©í–¥ ë¯¸ë¦¬ ê³„ì‚° ë° í‘œì‹œ
    const deltaX = touchStart.x - currentX;
    const deltaY = touchStart.y - currentY;
    
    console.log('Touch Move Delta:', { deltaX, deltaY, abs: { x: Math.abs(deltaX), y: Math.abs(deltaY) } });
    
    // ì´ë™ ê±°ë¦¬ê°€ ì¶©ë¶„íˆ í´ ë•Œë§Œ ë°©í–¥ íŒë‹¨
    if (Math.abs(deltaX) > 15 || Math.abs(deltaY) > 15) {
      // ê°€ë¡œ ìŠ¤ì™€ì´í”„ê°€ ì„¸ë¡œ ìŠ¤ì™€ì´í”„ë³´ë‹¤ í´ ë•Œ
      if (Math.abs(deltaX) > Math.abs(deltaY)) {
        setIsHorizontalSwipe(true);
        setIsSwiping(true);
        
        const currentTabIndex = getTabIndex(activeTab);
        const maxDelta = window.innerWidth * 0.4; // í™”ë©´ í­ì˜ 40%ë¥¼ ìµœëŒ€ ë“œë˜ê·¸ë¡œ ì„¤ì •
        const normalizedDelta = Math.max(-maxDelta, Math.min(maxDelta, deltaX));
        
        // íƒ­ ê²½ê³„ í™•ì¸
        const isAtLeftBoundary = currentTabIndex === 0 && deltaX < 0;
        const isAtRightBoundary = currentTabIndex === tabs.length - 1 && deltaX > 0;
        
        if (!isAtLeftBoundary && !isAtRightBoundary) {
          // ìŠ¤ì™€ì´í”„ ì˜¤í”„ì…‹ ê³„ì‚° (25% ê¸°ì¤€ìœ¼ë¡œ ì¡°ì •)
          const offsetPercentage = (normalizedDelta / maxDelta) * 25; // 25% = 100% / 4 tabs
          setSwipeOffset(offsetPercentage);
          
          // ì§„í–‰ë¥  ê³„ì‚° (ë” ê´€ëŒ€í•˜ê²Œ ì„¤ì •)
          const progress = Math.abs(deltaX) / swipeThreshold;
          setSwipeProgress(Math.min(progress, 1));
          
          // ìŠ¤ì™€ì´í”„ ë°©í–¥ ì„¤ì •
          setSwipeDirection(deltaX > 0 ? 'left' : 'right');
          
          console.log('Swipe offset:', offsetPercentage, 'Progress:', progress);
        }
        
        // ê°€ë¡œ ìŠ¤ì™€ì´í”„ë¡œ íŒë‹¨ë˜ë©´ ê¸°ë³¸ ìŠ¤í¬ë¡¤ ë°©ì§€
        e.preventDefault();
        e.stopPropagation();
        console.log('Horizontal swipe detected, preventing scroll');
      } else {
        // ì„¸ë¡œ ìŠ¤ì™€ì´í”„ëŠ” ê¸°ë³¸ ìŠ¤í¬ë¡¤ í—ˆìš©
        setIsHorizontalSwipe(false);
        setSwipeDirection(null);
        setIsSwiping(false);
        console.log('Vertical swipe detected, allowing scroll');
      }
    }
  };

  const handleTouchEnd = (e) => {
    console.log('Touch End Called', { canSwipe, isHorizontalSwipe, isSwiping });
    
    // ì´ë¯¸ ìŠ¤ì™€ì´í”„ ì²˜ë¦¬ ì¤‘ì´ë©´ ë¬´ì‹œ (ê°€ì¥ ë¨¼ì € ì²´í¬)
    if (!canSwipe) {
      console.log('Already processing swipe, ignoring');
      return;
    }
    
    // ê°€ë¡œ ìŠ¤ì™€ì´í”„ê°€ ì•„ë‹ˆì—ˆë‹¤ë©´ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
    if (!isHorizontalSwipe || !isSwiping) {
      resetSwipeState();
      console.log('Not horizontal swipe, ignoring');
      return;
    }
    
    // ìŠ¤ì™€ì´í”„ ì²˜ë¦¬ ì‹œì‘ - ì¦‰ì‹œ canSwipeë¥¼ falseë¡œ ì„¤ì •í•˜ì—¬ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    setCanSwipe(false);
    
    // ê°€ë¡œ ìŠ¤ì™€ì´í”„ì¸ ê²½ìš° ê¸°ë³¸ ë™ì‘ ë°©ì§€
    e.preventDefault();
    e.stopPropagation();
    
    if (!isSwipingAllowed || !touchStart.x || !touchEnd.x || currentView.type === 'detail') {
      resetSwipeState();
      // ì¼ì • ì‹œê°„ í›„ canSwipe ë³µì›
      setTimeout(() => setCanSwipe(true), 300);
      return;
    }

    const deltaX = touchStart.x - touchEnd.x;
    const deltaTime = Date.now() - touchStart.time;
    const maxSwipeTime = 800; // ìµœëŒ€ ìŠ¤ì™€ì´í”„ ì‹œê°„ ì¦ê°€

    console.log('Swipe Analysis:', { 
      deltaX, 
      deltaTime, 
      swipeThreshold,
      absX: Math.abs(deltaX),
      swipeProgress,
      canSwipe
    });

    // ìŠ¤ì™€ì´í”„ ì‹œê°„ì´ ë„ˆë¬´ ê¸¸ë©´ ë¬´ì‹œ
    if (deltaTime > maxSwipeTime) {
      console.log('Swipe too slow');
      resetSwipeState();
      setTimeout(() => setCanSwipe(true), 300);
      return;
    }
    
    // ì„ê³„ì  í™•ì¸ - ë” ê´€ëŒ€í•œ ì¡°ê±´
    const shouldChangeTab = Math.abs(deltaX) >= swipeThreshold * 0.6 || swipeProgress >= 0.25;
    
    if (shouldChangeTab) {
      // íƒ­ í˜ì´ì§€ì—ì„œ ìŠ¤ì™€ì´í”„ ì²˜ë¦¬
      const currentTabIndex = getTabIndex(activeTab);
      console.log('Current tab index:', currentTabIndex, 'Active tab:', activeTab);
      
      if (deltaX > 0 && currentTabIndex < tabs.length - 1) {
        // ì™¼ìª½ ìŠ¤ì™€ì´í”„ - ë‹¤ìŒ íƒ­ (dashboard â†’ browse â†’ analysis â†’ setting)
        console.log('Swiping to next tab:', tabs[currentTabIndex + 1].id);
        handleTabChange(tabs[currentTabIndex + 1].id);
      } else if (deltaX < 0 && currentTabIndex > 0) {
        // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ - ì´ì „ íƒ­
        console.log('Swiping to previous tab:', tabs[currentTabIndex - 1].id);
        handleTabChange(tabs[currentTabIndex - 1].id);
      } else {
        console.log('No tab change - at boundary');
      }
      
      // íƒ­ ì „í™˜ í›„ ë” ê¸´ ëŒ€ê¸° ì‹œê°„
      setTimeout(() => setCanSwipe(true), 500);
    } else {
      console.log('Swipe not strong enough, reverting');
      // íƒ­ ì „í™˜í•˜ì§€ ì•Šì„ ë•ŒëŠ” ì§§ì€ ëŒ€ê¸° ì‹œê°„
      setTimeout(() => setCanSwipe(true), 300);
    }

    // ìŠ¤ì™€ì´í”„ ìƒíƒœ ë¦¬ì…‹
    resetSwipeState();
  };

  // ìŠ¤ì™€ì´í”„ ìƒíƒœ ë¦¬ì…‹ í•¨ìˆ˜
  const resetSwipeState = () => {
    console.log('Resetting swipe state');
    setTouchStart({ x: 0, y: 0, time: 0 });
    setTouchEnd({ x: 0, y: 0 });
    setSwipeDirection(null);
    setIsHorizontalSwipe(false);
    setIsSwiping(false);
    setSwipeProgress(0);
    setSwipeOffset(0);
    // canSwipeëŠ” ì—¬ê¸°ì„œ ë¦¬ì…‹í•˜ì§€ ì•ŠìŒ - ê° í•¸ë“¤ëŸ¬ì—ì„œ íƒ€ì´ë¨¸ë¡œ ê´€ë¦¬
  };

  // íœ  ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (ì¢Œìš° ìŠ¤í¬ë¡¤ë¡œ íƒ­ ì „í™˜)
  const handleWheel = (e) => {
    if (!isSwipingAllowed || currentView.type === 'detail') return;

    // ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì´ë©´ ë¬´ì‹œ (ê°€ì¥ ë¨¼ì € ì²´í¬)
    if (!canSwipe) {
      console.log('Wheel: Already processing, ignoring');
      return;
    }

    const deltaX = e.deltaX;
    const deltaY = e.deltaY;
    const minWheelDistance = 30; // ìµœì†Œ íœ  ì´ë™ ê±°ë¦¬

    console.log('Wheel Event:', { deltaX, deltaY, canSwipe });

    // ì„¸ë¡œ ìŠ¤í¬ë¡¤ì´ ê°€ë¡œ ìŠ¤í¬ë¡¤ë³´ë‹¤ í¬ë©´ ë¬´ì‹œ (ê¸°ë³¸ ìŠ¤í¬ë¡¤ í—ˆìš©)
    if (Math.abs(deltaY) > Math.abs(deltaX)) {
      console.log('Vertical wheel detected, allowing default scroll');
      return;
    }

    // íœ  ì´ë™ ê±°ë¦¬ê°€ ìµœì†Œ ê±°ë¦¬ë³´ë‹¤ ì‘ìœ¼ë©´ ë¬´ì‹œ
    if (Math.abs(deltaX) < minWheelDistance) {
      console.log('Wheel distance too small:', Math.abs(deltaX));
      return;
    }

    // íœ  ì²˜ë¦¬ ì‹œì‘ - ì¦‰ì‹œ canSwipeë¥¼ falseë¡œ ì„¤ì •í•˜ì—¬ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    setCanSwipe(false);

    // ê°€ë¡œ ìŠ¤í¬ë¡¤ì´ í™•ì‹¤í•œ ê²½ìš°ì—ë§Œ ê¸°ë³¸ ë™ì‘ ë°©ì§€
    e.preventDefault();

    // ì—°ì† íœ  ì´ë²¤íŠ¸ ë°©ì§€ë¥¼ ìœ„í•œ ë””ë°”ìš´ì‹±
    if (wheelTimeout) {
      clearTimeout(wheelTimeout);
    }

    const currentTabIndex = getTabIndex(activeTab);
    console.log('Wheel - Current tab index:', currentTabIndex, 'Active tab:', activeTab);

    // ìŠ¤ì™€ì´í”„ ë°©í–¥ í‘œì‹œ
    const direction = deltaX > 0 ? 'left' : 'right';
    setSwipeDirection(direction);

    // íœ  ë°©í–¥ì— ë”°ë¥¸ íƒ­ ì „í™˜
    if (deltaX > 0 && currentTabIndex < tabs.length - 1) {
      // ì˜¤ë¥¸ìª½ ìŠ¤í¬ë¡¤ - ë‹¤ìŒ íƒ­
      console.log('Wheel scrolling to next tab:', tabs[currentTabIndex + 1].id);
      handleTabChange(tabs[currentTabIndex + 1].id);
    } else if (deltaX < 0 && currentTabIndex > 0) {
      // ì™¼ìª½ ìŠ¤í¬ë¡¤ - ì´ì „ íƒ­
      console.log('Wheel scrolling to previous tab:', tabs[currentTabIndex - 1].id);
      handleTabChange(tabs[currentTabIndex - 1].id);
    } else {
      console.log('No tab change - at boundary or invalid wheel scroll');
    }

    // ìŠ¤ì™€ì´í”„ ë°©í–¥ í‘œì‹œë¥¼ ì¼ì • ì‹œê°„ í›„ ì œê±°
    const newTimeout = setTimeout(() => {
      setSwipeDirection(null);
    }, 300);
    setWheelTimeout(newTimeout);

    // canSwipe ë³µì›
    setTimeout(() => setCanSwipe(true), 400);
  };

  // ì•„ì´í…œ í´ë¦­ ì²˜ë¦¬
  const handleItemClick = (item) => {
    setCurrentView({ type: 'detail', data: item });
  };

  // ë’¤ë¡œ ê°€ê¸°
  const handleBack = () => {
    setCurrentView({ type: 'tab', data: null });
  };

  // ì•„ì´í…œ ìŠ¹ì¸ ì²˜ë¦¬
  const handleApprove = (item) => {
    setItemsData(prevData => {
      const newData = { ...prevData };
      
      // ìŠ¹ì¸ ëŒ€ê¸°ì—ì„œ ì œê±°
      if (prevData.pending[item.type]) {
        newData.pending[item.type] = prevData.pending[item.type].filter(i => i.id !== item.id);
      }
      
      // ìŠ¹ì¸ëœ ì•„ì´í…œì— ì¶”ê°€
      if (!newData.approved[item.type]) {
        newData.approved[item.type] = [];
      }
      newData.approved[item.type].push({
        ...item,
        status: 'approved',
        approvedAt: new Date().toISOString().split('T')[0]
      });

      // ë‹¤ìŒ ë‹¨ê³„ ì•„ì´í…œ ìƒì„±
      const nextStepItem = generateNextStepItem(item);
      if (nextStepItem) {
        if (!newData.working[nextStepItem.type]) {
          newData.working[nextStepItem.type] = [];
        }
        newData.working[nextStepItem.type].push(nextStepItem);
      }

      return newData;
    });

    // ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
    setCurrentView({ type: 'tab', data: null });
  };

  // í”¼ë“œë°± ì²˜ë¦¬
  const handleFeedback = (item, feedbackText) => {
    setItemsData(prevData => {
      const newData = { ...prevData };
      
      // ìŠ¹ì¸ ëŒ€ê¸°ì—ì„œ ì œê±°
      if (prevData.pending[item.type]) {
        newData.pending[item.type] = prevData.pending[item.type].filter(i => i.id !== item.id);
      }
      
      // ì‘ì—… ì¤‘ ì•„ì´í…œì— ì¶”ê°€ (ìˆ˜ì • ìš”ì²­ ìƒíƒœ)
      if (!newData.working[item.type]) {
        newData.working[item.type] = [];
      }
      newData.working[item.type].push({
        ...item,
        status: 'generating',
        feedbackCount: item.feedbackCount + 1,
        workStatus: 'revision_requested',
        lastFeedback: feedbackText,
        feedbackAt: new Date().toISOString().split('T')[0]
      });

      return newData;
    });

    // ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
    setCurrentView({ type: 'tab', data: null });
  };

  // ë‹¤ìŒ ë‹¨ê³„ ì•„ì´í…œ ìƒì„±
  const generateNextStepItem = (approvedItem) => {
    const getNextId = (type) => {
      const allItems = [
        ...itemsData.pending[type] || [],
        ...itemsData.working[type] || [],
        ...itemsData.approved[type] || []
      ];
      return Math.max(...allItems.map(item => item.id), 0) + 1;
    };

    switch (approvedItem.type) {
      case 'series':
        // ì‹œë¦¬ì¦ˆ ìŠ¹ì¸ ì‹œ ìºë¦­í„° ìƒì„±
        return {
          id: getNextId('character'),
          type: 'character',
          title: `${approvedItem.title}ì˜ ì£¼ìš” ìºë¦­í„°`,
          description: `${approvedItem.title} ì‹œë¦¬ì¦ˆì— ë§ëŠ” ìºë¦­í„°`,
          status: 'generating',
          feedbackCount: 0,
          createdAt: new Date().toISOString().split('T')[0],
          aiGenerated: true,
          seriesId: approvedItem.id,
          workStatus: 'generating'
        };
      
      case 'character':
        // ìºë¦­í„° ìŠ¹ì¸ ì‹œ ì—í”¼ì†Œë“œ ìƒì„±
        return {
          id: getNextId('episode'),
          type: 'episode',
          title: `${approvedItem.title} ì¤‘ì‹¬ ì—í”¼ì†Œë“œ`,
          description: `${approvedItem.title}ê°€ ë“±ì¥í•˜ëŠ” ì—í”¼ì†Œë“œ`,
          status: 'generating',
          feedbackCount: 0,
          createdAt: new Date().toISOString().split('T')[0],
          aiGenerated: true,
          seriesId: approvedItem.seriesId,
          characterId: approvedItem.id,
          workStatus: 'generating'
        };
      
      default:
        return null;
    }
  };


  // ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ - ëª¨ë“  hooksì™€ í•¨ìˆ˜ ì •ì˜ ì´í›„ì— ë°°ì¹˜
  if (!user) {
    return (
      <div className="app">
        {showAuthModal === 'login' ? (
          <Login 
            onLoginSuccess={handleLoginSuccess}
            onSwitchToSignup={() => handleAuthSwitch('signup')}
          />
        ) : (
          <Signup 
            onSignupSuccess={() => handleAuthSwitch('login')}
            onSwitchToLogin={() => handleAuthSwitch('login')}
          />
        )}
      </div>
    );
  }

  return (
    <div 
      className="app"
      onTouchStart={handleTouchStart}
      onTouchMove={handleTouchMove}
      onTouchEnd={handleTouchEnd}
      onWheel={handleWheel}
    >

      {/* Swipe Indicator */}
      {swipeDirection && (
        <div className={`swipe-indicator ${swipeDirection}`}>
          <div className="swipe-arrow">
            {swipeDirection === 'left' ? 'â†’' : 'â†'}
          </div>
          <div className="swipe-text">
            {swipeDirection === 'left' ? 'ë‹¤ìŒ íƒ­' : 'ì´ì „ íƒ­'}
          </div>
        </div>
      )}

      {/* Debug Info - ê°œë°œ ëª¨ë“œì—ì„œë§Œ í‘œì‹œ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) */}
      {process.env.NODE_ENV === 'development' && false && (
        <div className="debug-info">
          <div>Active Tab: {activeTab}</div>
          <div>Touch Start: {touchStart.x}, {touchStart.y}</div>
          <div>Touch End: {touchEnd.x}, {touchEnd.y}</div>
          <div>Swipe Direction: {swipeDirection || 'none'}</div>
          <div>Is Horizontal: {isHorizontalSwipe ? 'Yes' : 'No'}</div>
          <div>Swiping Allowed: {isSwipingAllowed ? 'Yes' : 'No'}</div>
          <div>Current View: {currentView.type}</div>
          <div>Is Swiping: {isSwiping ? 'Yes' : 'No'}</div>
          <div>Swipe Progress: {Math.round(swipeProgress * 100)}%</div>
          <div>Swipe Offset: {swipeOffset.toFixed(1)}%</div>
          <div>Can Swipe: {canSwipe ? 'Yes' : 'No'}</div>
          <div>ğŸ’¡ Use horizontal scroll or touch swipe</div>
        </div>
      )}

      {/* Swipe Progress Indicator */}
      {isSwiping && (
        <div className={`swipe-progress-indicator ${!isSwiping ? 'hidden' : ''}`}>
          <div className="progress-bar">
            <div 
              className="progress-fill" 
              style={{ width: `${swipeProgress * 100}%` }}
            />
          </div>
          <span className="progress-text">
            {swipeProgress >= 0.25 ? 'ë†“ìœ¼ë©´ íƒ­ ì „í™˜' : 'ë” ë°€ì–´ì£¼ì„¸ìš”'}
          </span>
        </div>
      )}

      {/* Main Content */}
      <div className={`app-container ${currentView.type === 'detail' ? 'detail-view' : ''}`}>
        {currentView.type === 'detail' ? (
          <ItemDetail
            item={currentView.data}
            onBack={handleBack}
            onApprove={handleApprove}
            onFeedback={handleFeedback}
            onSwipeDisable={setIsSwipingAllowed}
          />
        ) : (
          <div 
            className={`tabs-container ${isSwiping ? 'swiping' : ''}`}
            style={{
              transform: `translateX(${getTabOffset()}%)`
            }}
          >
            {/* Dashboard Tab Panel */}
            <div className="tab-panel">
              <main className="main-content">
                <Dashboard 
                  itemsData={itemsData}
                  onItemClick={handleItemClick}
                  user={user}
                />
              </main>
            </div>

            {/* Browse Tab Panel */}
            <div className="tab-panel">
              <main className="main-content">
                <Browse 
                  itemsData={itemsData}
                  onItemClick={handleItemClick}
                  onApprove={handleApprove}
                  onFeedback={handleFeedback}
                />
              </main>
            </div>

            {/* Analysis Tab Panel */}
            <div className="tab-panel">
              <main className="main-content">
                <Analysis />
              </main>
            </div>

            {/* Setting Tab Panel */}
            <div className="tab-panel">
              <main className="main-content">
                <Setting onLogout={handleLogout} />
              </main>
            </div>
          </div>
        )}
      </div>

      {/* Bottom Header */}
      <footer className="bottom-header">
        <div className="help-rotator">
          <div className="help-carousel">
            <div className="help-text">ğŸ’¡ ì¢Œìš° ìŠ¤ì™€ì´í”„ë¡œ íƒ­ ì „í™˜</div>
            <div className="help-text">ğŸ¯ í•­ëª©ì„ í´ë¦­í•´ì„œ ìì„¸íˆ ë³´ê¸°</div>
            <div className="help-text">âš¡ í”¼ë“œë°±ìœ¼ë¡œ AIê°€ ê°œì„ </div>
            <div className="help-text">ğŸš€ ìŠ¹ì¸í•˜ë©´ ë‹¤ìŒ ë‹¨ê³„ ìƒì„±</div>
          </div>
        </div>
        
        <div className="tab-indicator">
          <div className="tab-dots">
            {tabs.map((tab, index) => (
              <div
                key={tab.id}
                className={`tab-item ${activeTab === tab.id ? 'active' : ''}`}
                onClick={() => handleTabChange(tab.id)}
                title={tab.label}
              >
                <div className="tab-icon">
                  <img src={tab.icon} alt={tab.label} />
                </div>
                <span className="tab-label">{tab.label.toLowerCase()}</span>
              </div>
            ))}
          </div>
        </div>
        
        <div className="header-right">
          <span className="user-name">{user?.username ? `${user.username}ë‹˜` : user?.nickname ? `${user.nickname}ë‹˜` : `${user?.email}ë‹˜`}</span>
        </div>
      </footer>
    </div>
  );
}

function App() {
  return (
    <Router>
      <AppContent />
    </Router>
  );
}

export default App;
